name: GCP Inventory Workflow

on:
  workflow_dispatch:

jobs:
  gcp-inventory:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout code
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. Set up Python 3.11
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 3. Decode GCP Key from GitHub Secret
    - name: Decode GCP Key
      run: |
        echo "${{ secrets.GCP_KEY_BASE64 }}" | base64 -d > $HOME/gcp-key.json
        echo "GOOGLE_APPLICATION_CREDENTIALS=$HOME/gcp-key.json" >> $GITHUB_ENV

    # 4. Create virtual environment and install dependencies
    - name: Install Python Dependencies
      run: |
        python -m venv venv
        source venv/bin/activate
        pip install --upgrade pip
        pip install google-cloud-compute 
        pip install google-cloud-storage
        pip install google-cloud-bigquery 
        pip install google-cloud-monitoring
        pip install google-auth 
        pip install google-auth-oauthlib 
        pip install google-auth-httplib2 
        pip install grpcio protobuf
        pip install Jinja2 
        pip install google-api-python-client

    # 5. Run GCP VM Inventory Script
    - name: Run GCP VM Inventory Script
      run: ./venv/bin/python VirtualMachine/VirtualMachine.py


    # # 6. Run GCP Disk Script
    # - name: Run GCP Disk Script
    #   run: |
    #     source venv/bin/activate
    #     python GCP-Disk/disk.py

    # # 7. Run GCP Bucket Script
    # - name: Run GCP Bucket Script
    #   run: |
    #     source venv/bin/activate
    #     python Bucket/bucket.py

    # # 8. Run GCP Snapshot Script
    # - name: Run GCP Snapshot Script
    #   run: |
    #     source venv/bin/activate
    #     python Snapshot/snapshot.py

    # # 9. Run GCP Dashboard Script
    # - name: Run GCP Dashboard Script
    #   run: |
    #     source venv/bin/activate
    #     python Dashboard/main.py

    # # 10. Run GCP Health Check Script
    # - name: Run GCP Health Check Script
    #   run: |
    #     source venv/bin/activate
    #     python healthcheckreport/main_dashboard.py
